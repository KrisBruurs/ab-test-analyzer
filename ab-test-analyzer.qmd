---
title: "ab-test-analyzer"
author: "Kris Bruurs"
format: html
editor: visual
---

# A/B Test Analyzer

## 0. Contents

-   1\. Introduction
-   2\. Data Handling
    -   2.1. Data Preperation
    -   2.2 Data Exploration
-   3\. Hypothesis Testing
    -   3.1 **H1:** Purchases รท Impressions (purchase conversion rate)
        -   3.1.1 Code
        -   3.1.2 Report
    -   3.2 **H2:** Reach รท Impressions (unique reach ratio)
        -   3.2.1 Code
        -   3.2.2 Report
    -   3.3 **H3:** Purchases รท Add to Cart (checkout conversion)
        -   3.3.1 Code
        -   3.3.2 Report
    -   3.4 **H4:** Searches/View Content/Add to Cart รท Impressions (upper/mid-funnel rates)
        -   3.4.1 Code
        -   3.4.2 Report
-   4\. Final Report

## 1. Introduction

The dataset shows the results of a 30 day A/B test for a fictional company's website. The outputs are the following variables:

-   **Campaign Name:** Name of the campaign version (*Control / Test*)
-   **Date:** Date of the record
-   **Spend:** Amount spend on the campaign in USD
-   **Number of Impressions:** Number of impressions the ad crossed through the campaign
-   **Reach:** The number of unique impressions received on the ad
-   **Number of Website Clicks:** Number of website clicks received through the ad
-   **Number of Searches:** Number of users who performed searches on the website
-   **Number of View Content:** Number of users who viewed products and content on the website
-   **Number of Add to Cart:** Number of users who added products to the cart
-   **Number of Purchase:** Number of purchases

The data shows no **Average Spend per Purchase** variable. Therefore a complete analysis of campaign effectiveness gets harder. Metrics such as ROAS or ROI are impossible to measure with the available data.

However, the data allows for an analysis of engagement. Questions that can be answered are:

-   Does the test campaign convert more impressions into purchases than the control campaign?

-   Does the test campaign have more impressions from unique users than the control campaign?

-   Does the test campaign convert more 'add to carts' into purchases than the control campaign?

-   Does the test campaign convert more impressions into searches/view content/add to cart than the control campaign?

## 2. Data Handling

### 2.1 Data Preparation

#### Load Libraries

```{r}
library(tidyverse)
```

#### Load Data

```{r}
control <- read_delim('data/control_group.csv', delim = ';')
test <- read_delim('data/test_group.csv', delim = ';')

```

#### Merge Data

Merge two files together:

```{r}
combined_data <- control %>% 
  bind_rows(test)
```

#### Rename Variables

```{r}
combined_data <- combined_data %>% 
  rename(Campaign_Name = `Campaign Name`,
         Spend = `Spend [USD]`,
         Impressions = `# of Impressions`,
         Clicks = `# of Website Clicks`,
         Searches = `# of Searches`,
         View_Content = `# of View Content`,
         Add_Cart = `# of Add to Cart`,
         Purchase = `# of Purchase`)
```

#### Data Cleaning

Inspection of the data shows that the control campaign has not collected data except for costs. Therefore, this row is removed

```{r}
combined_data <- combined_data %>%
  filter(!(is.na(Impressions) & is.na(Clicks) & is.na(Searches) &
           is.na(View_Content) & is.na(Add_Cart) & is.na(Purchase)))
```

### 2.2 Data Exploration

```{r}
combined_data %>% 
  ggplot(aes(x = Campaign_Name, y = Spend, fill = Campaign_Name)) +
  geom_col() +
  labs(y = 'Spend in USD',
       x = NULL,
       fill = "Campaign Version",
       title = 'Spenditure Between Campaign Versions') +
  theme(axis.text.x = element_blank())
  
```

```{r}
mean_spend_control <- combined_data %>% 
  group_by(Campaign_Name) %>% 
  summarize(mean_spend = mean(Spend)) %>% 
  pluck(2,1)

mean_spend_test <- combined_data %>% 
  group_by(Campaign_Name) %>% 
  summarize(mean_spend = mean(Spend)) %>% 
  pluck(2,2)

avg_spend_diff <- mean_spend_test - mean_spend_control
round(avg_spend_diff, 2)
```

```{r}

```

The Test Campaign is on average about \$259 dollar more expensive per day than the Control Campaign.

### Hypothesis Testing

*H1:* Does the test campaign convert more impressions into purchases than the control campaign?

```{r}
totals <- combined_data %>% 
  group_by(Campaign_Name) %>% 
  summarise(sum_impressions = sum(Impressions),
            sum_purchase = sum(Purchase),
            sum_reach = sum(Reach),
            sum_add_cart = sum(Add_Cart),
            sum_clicks = sum(Clicks),
            sum_view_content = sum(View_Content),
            sum_searches = sum(Searches),
            sum_spend = sum(Spend))
totals
```

#### Impression / Purchase

```{r}
prop.test(x = totals$sum_purchase, 
          n = totals$sum_impressions,
          alternative = 'two.sided')
```

#### Reach / Purchase

```{r}
prop.test(x = totals$sum_purchase, 
          n = totals$sum_reach,
          alternative = 'two.sided')
```

#### Impressions / Reach

-   Does the test campaign have more impressions from unique users than the control campaign?

```{r}
prop.test(x = totals$sum_reach,
          n = totals$sum_impressions,
          alternative = 'two.sided')
```

#### H3

-   Does the test campaign convert more 'add to carts' into purchases than the control campaign?

```{r}
prop.test(x = totals$sum_purchase,
          n = totals$sum_add_cart,
          alternative = 'two.sided')
```

```{r}
totals %>% 
  group_by(Campaign_Name) %>% 
  summarize(cpp = sum_spend/sum_purchase)
```

```{r}
prop.test(x = totals$sum_purchase,
          n = totals$sum_spend,
          alternative = 'two.sided')
```
